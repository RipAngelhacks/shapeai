<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Simple Chat Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-950 to-black text-white h-screen flex flex-col">
    <div class="flex flex-1 overflow-hidden flex-col md:flex-row">
        <!-- Sidebar -->
        <div id="mobileSidebar" class="w-full md:w-1/4 bg-gray-900 p-5 border-r border-gray-800 overflow-y-auto max-h-screen">
            <h1 class="text-2xl font-bold mb-4 text-white">💬 Chat</h1>
            
            <!-- Connection Input -->
            <div class="relative mb-2">
                <input id="username" type="text" placeholder="Enter your username"
                    class="w-full px-3 py-2 rounded bg-gray-100 text-black focus:outline-none mb-2" />
                <input id="apiEndpoint" type="text" placeholder="API Endpoint"
                    class="w-full px-3 py-2 rounded bg-gray-100 text-black focus:outline-none" />
            </div>
            <button id="connectBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded mb-2">Connect</button>
            <button id="disconnectBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded hidden">Disconnect</button>
        </div>

        <!-- Chat Area -->
        <div class="flex flex-col w-full h-full overflow-hidden">
            <!-- Chat Header -->
            <div class="text-center py-3 text-lg font-semibold bg-gray-800 shadow-sm flex justify-center items-center gap-2 border-b border-gray-700">
                Status: <span id="connectionStatus" class="text-red-400 ml-1">Not connected</span>
            </div>

            <!-- Chat Messages -->
            <div id="chat" class="flex-1 overflow-y-auto px-4 py-4 space-y-2 bg-gradient-to-tr from-black via-gray-900 to-gray-950">
                <!-- Messages will appear here -->
            </div>

            <!-- Message Input -->
            <form id="chatForm" class="flex items-center gap-2 bg-gray-900 border-t border-gray-800 p-3">
                <input id="msg" type="text" placeholder="Type your message..."
                    class="flex-grow px-4 py-2 rounded bg-gray-800 text-white focus:outline-none" autocomplete="off" />
                <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded whitespace-nowrap">Send</button>
            </form>
        </div>
    </div>

    <script>
        // Chat functionality
        let connected = false;
        const chat = document.getElementById('chat');
        const chatForm = document.getElementById('chatForm');
        const msgInput = document.getElementById('msg');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const statusEl = document.getElementById('connectionStatus');
        const usernameInput = document.getElementById('username');
        const apiEndpointInput = document.getElementById('apiEndpoint');

        function appendMessage(role, content, timestamp = new Date().toISOString()) {
            const wrapper = document.createElement('div');
            wrapper.className = `flex w-full mb-2 ${role === 'user' ? 'justify-end' : 'justify-start'}`;

            const bubble = document.createElement('div');
            bubble.className = `max-w-[75%] p-3 rounded-lg ${role === 'user' ? 'bg-indigo-600' : 'bg-gray-700'}`;
            
            const timeStr = new Date(timestamp).toLocaleTimeString();
            bubble.innerHTML = `
                <div class="text-sm">${content}</div>
                <div class="text-xs text-gray-400 mt-1">${timeStr}</div>
            `;

            wrapper.appendChild(bubble);
            chat.appendChild(wrapper);
            chat.scrollTop = chat.scrollHeight;
        }

        function connect() {
            const username = usernameInput.value.trim();
            const apiEndpoint = apiEndpointInput.value.trim();
            
            if (!username || !apiEndpoint) {
                alert('Please enter both username and API endpoint');
                return;
            }

            connected = true;
            statusEl.textContent = 'Connected';
            statusEl.classList.remove('text-red-400');
            statusEl.classList.add('text-green-400');
            connectBtn.classList.add('hidden');
            disconnectBtn.classList.remove('hidden');
            
            appendMessage('system', '🟢 Connected successfully');
        }

        function disconnect() {
            connected = false;
            statusEl.textContent = 'Not connected';
            statusEl.classList.remove('text-green-400');
            statusEl.classList.add('text-red-400');
            connectBtn.classList.remove('hidden');
            disconnectBtn.classList.add('hidden');
            
            appendMessage('system', '🔴 Disconnected');
        }

        connectBtn.addEventListener('click', connect);
        disconnectBtn.addEventListener('click', disconnect);

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = msgInput.value.trim();
            if (!message || !connected) return;

            appendMessage('user', message);
            msgInput.value = '';

            try {
                const apiEndpoint = apiEndpointInput.value.trim();
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message,
                        username: usernameInput.value.trim()
                    })
                });

                const data = await response.json();
                appendMessage('bot', data.response || 'No response');
            } catch (error) {
                appendMessage('system', '⚠️ Error: ' + error.message);
            }
        });

        // Save settings to localStorage
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('chatUsername', usernameInput.value);
            localStorage.setItem('chatApiEndpoint', apiEndpointInput.value);
        });

        // Load saved settings
        window.addEventListener('DOMContentLoaded', () => {
            usernameInput.value = localStorage.getItem('chatUsername') || '';
            apiEndpointInput.value = localStorage.getItem('chatApiEndpoint') || '';
        });
    </script>
</body>
</html>
